[gd_scene load_steps=40 format=3 uid="uid://4snjsakcym8b"]

[ext_resource type="Texture2D" uid="uid://p3rabq32mllb" path="res://assets/art/1 Characters/1/1.png" id="1_f50pn"]

[sub_resource type="GDScript" id="GDScript_4j004"]
script/source = "extends CharacterBody2D

# Movement
const SPEED = 100.0
const DASH_SPEED = 200.0
const DASH_DURATION = 0.2
const DASH_COOLDOWN = 0.8
const OUTER_TILE_SLOW_FACTOR = 0.5

# Melee attack
const ATTACK_HITBOX_TIME = 0.1
const ATTACK_RECOVERY = 0.1
const HIT_DAMAGE_HP = 5.0
const HIT_DAMAGE_PERCENT = 10.0

# Projectile attack
const PROJECTILE_COOLDOWN := 0.6
@onready var arrow_projectile = load(\"res://assets/objects/arrow_projectile.tscn\")
var projectile_timer := 0.0

# Knockback
const BASE_KNOCKBACK = 200.0
const KNOCKBACK_DURATION = 0.3

# Outer tile damage
const OUTER_DAMAGE_INTERVAL := 0.25
const OUTER_DAMAGE_AMOUNT := 1.0

@onready var anim_tree: AnimationTree = $AnimationTree
@onready var anim_state = anim_tree.get(\"parameters/playback\")
@onready var anim_player: AnimationPlayer = $AnimationPlayer
@onready var hitbox: Area2D = $AttackHitBox
@onready var tilemap: TileMap = $\"../TileMap\"

@onready var damage_label: Label = get_node(\"../CanvasLayer/DamageLabel\")
@export var respawn_position: Vector2
@export var stocks: int = 3

var is_attacking: bool = false
var is_dead: bool = false
var last_direction: Vector2 = Vector2.DOWN
var dash_timer: float = 0.0
var dash_active: float = 0.0
var last_printed_second: int = -1
var knockback_timer: float = 0.0

var hp: float = 100.0
var damage_percent: float = 0.0
var outer_damage_timer: float = 0.0

func _ready() -> void:
	hitbox.connect(\"body_entered\", Callable(self, \"_on_hitbox_body_entered\"))
	hitbox.monitoring = false
	hitbox.monitorable = true
	_update_label()

	# Critical: set authority based on node name (\"1\", \"2\", ...)
	if name.is_valid_int():
		set_multiplayer_authority(int(name))

	print(name, \"READY. Authority:\", is_multiplayer_authority())

	# Remote players: no input, but still apply replicated state
	if not is_multiplayer_authority():
		set_process_input(false)
		set_physics_process(true)
		return

func _physics_process(delta: float) -> void:
	if is_dead or stocks <= 0:
		return

	# Projectile cooldown
	if projectile_timer > 0.0:
		projectile_timer -= delta

	# Outer tile damage cooldown tick
	if outer_damage_timer > 0.0:
		outer_damage_timer -= delta

	# Knockback overrides everything
	if knockback_timer > 0.0:
		knockback_timer -= delta
		velocity = velocity.move_toward(Vector2.ZERO, 1000 * delta)
		move_and_slide()
		_sync_state()
		return

	# Dash cooldown
	if dash_timer > 0.0:
		dash_timer -= delta

	# Dash active
	if dash_active > 0.0:
		dash_active -= delta
		velocity = last_direction.normalized() * DASH_SPEED
		move_and_slide()
		_sync_state()
		return

	# Melee attack
	if Input.is_action_just_pressed(\"attack_2\") and not is_attacking:
		_start_attack()
		_sync_state()
		return

	# Ranged attack
	if Input.is_action_just_pressed(\"ranged_attack_2\") and projectile_timer <= 0.0:
		_fire_projectile_networked()
		_sync_state()
		return

	# Dash input
	if Input.is_action_just_pressed(\"dash_2\") and dash_timer <= 0.0:
		_cancel_attack_if_needed()
		_start_dash()
		dash_timer = DASH_COOLDOWN

	# If attacking, stop movement
	if is_attacking:
		velocity = Vector2.ZERO
		move_and_slide()
		_sync_state()
		return

	# Movement
	var input_vector = Vector2(
		Input.get_axis(\"ui_left\", \"ui_right\"),
		Input.get_axis(\"ui_up\", \"ui_down\")
	).normalized()

	if input_vector != Vector2.ZERO:
		if input_vector.x != 0 and input_vector.y != 0:
			last_direction = Vector2(sign(input_vector.x), 0)
		else:
			last_direction = input_vector

	# Outer tile check
	var tile_pos = tilemap.local_to_map(global_position)
	var atlas_coords = tilemap.get_cell_atlas_coords(0, tile_pos)

	var current_speed = SPEED
	if atlas_coords == Vector2i(15, 2):
		if outer_damage_timer <= 0.0:
			take_outer_damage(OUTER_DAMAGE_AMOUNT)
			outer_damage_timer = OUTER_DAMAGE_INTERVAL
		current_speed = SPEED * OUTER_TILE_SLOW_FACTOR
	else:
		outer_damage_timer = 0.0

	velocity = input_vector * current_speed
	move_and_slide()

	_update_anim(input_vector)
	_sync_state()

# ---------------------------
# Multiplayer sync
# ---------------------------

func _sync_state() -> void:
	if not is_multiplayer_authority():
		return
	var mp := multiplayer.multiplayer_peer
	if mp == null or mp.get_connection_status() != MultiplayerPeer.CONNECTION_CONNECTED:
		return
	rpc(
		\"sync_remote_state\",
		global_position,
		velocity,
		last_direction,
		hp,
		damage_percent,
		is_attacking,
		is_dead,
		stocks
	)

@rpc(\"unreliable\", \"any_peer\")
func sync_remote_state(
	pos: Vector2,
	vel: Vector2,
	dir: Vector2,
	remote_hp: float,
	remote_damage_percent: float,
	remote_is_attacking: bool,
	remote_is_dead: bool,
	remote_stocks: int
) -> void:

	if is_multiplayer_authority():
		return

	global_position = pos
	velocity = vel
	last_direction = dir
	hp = remote_hp
	damage_percent = remote_damage_percent
	is_attacking = remote_is_attacking
	is_dead = remote_is_dead
	stocks = remote_stocks

	_update_label()

	if is_dead or stocks <= 0:
		visible = false
		set_physics_process(false)
	else:
		visible = true
		set_physics_process(true)

# ---------------------------
# Attack / animation
# ---------------------------

func _start_attack() -> void:
	is_attacking = true
	anim_state.travel(\"attack\")
	anim_tree.set(\"parameters/attack/blend_position\", last_direction)

	_update_hitbox_position()

	# Ensure the hitbox shape is enabled during the window
	var shape := hitbox.get_node_or_null(\"CollisionShape2D\")
	if shape:
		shape.disabled = false

	hitbox.set_deferred(\"monitoring\", true)
	await get_tree().create_timer(ATTACK_HITBOX_TIME).timeout
	hitbox.set_deferred(\"monitoring\", false)

	if shape:
		shape.disabled = true

	await get_tree().create_timer(ATTACK_RECOVERY).timeout
	is_attacking = false

func _fire_projectile_networked() -> void:
	# Put ranged attack on cooldown
	projectile_timer = PROJECTILE_COOLDOWN

	# Play attack anim
	is_attacking = true
	anim_state.travel(\"attack\")
	anim_tree.set(\"parameters/attack/blend_position\", last_direction)

	# Spawn projectile halfway through the animation â€” spawn local, then broadcast
	await get_tree().create_timer(ATTACK_HITBOX_TIME).timeout
	# In _fire_projectile_networked()
	var spawn_pos = global_position + last_direction.normalized() * 20
	var ang = last_direction.angle()
	spawn_arrow(spawn_pos, ang)
	rpc_id(0, \"spawn_arrow\", spawn_pos, ang)


	# Recovery
	await get_tree().create_timer(ATTACK_RECOVERY).timeout
	is_attacking = false

@rpc(\"reliable\", \"any_peer\", \"call_local\")
func spawn_arrow(spawn_pos: Vector2, angle: float) -> void:
	var instance = arrow_projectile.instantiate()

	# Place and orient directly
	instance.global_position = spawn_pos
	instance.rotation = angle

	# If the arrow scene has a setup API, use it
	if instance.has_method(\"setup\"):
		# Pass shooter peer id so the arrow can set authority/ownership internally if needed
		instance.setup(spawn_pos, angle, int(name))

	# Add to a shared container to avoid viewport/parenting quirks
	var scene := get_tree().get_current_scene()
	var projectiles := scene.get_node_or_null(\"Projectiles\")
	if projectiles == null:
		get_parent().add_child(instance)
	else:
		projectiles.add_child(instance)

func _cancel_attack_if_needed() -> void:
	if is_attacking:
		is_attacking = false

func _update_anim(input_vector: Vector2) -> void:
	if is_attacking:
		return

	if input_vector == Vector2.ZERO:
		anim_state.travel(\"idle\")
	else:
		anim_state.travel(\"walk\")

	anim_tree.set(\"parameters/walk/blend_position\", last_direction)
	anim_tree.set(\"parameters/idle/blend_position\", last_direction)

func _update_hitbox_position() -> void:
	if last_direction.x < 0:
		hitbox.position = Vector2(-6, -4)
	elif last_direction.x > 0:
		hitbox.position = Vector2(6, -4)
	elif last_direction.y < 0:
		hitbox.position = Vector2(0, -12)
	elif last_direction.y > 0:
		hitbox.position = Vector2(0, 7)

func _on_hitbox_body_entered(body: Node) -> void:
	# Only the authority applies damage; remote players just replicate results.
	if is_multiplayer_authority() and body.has_method(\"take_hit\"):
		var direction = (body.global_position - global_position).normalized()
		body.take_hit(direction, HIT_DAMAGE_HP)

# ---------------------------
# Damage / death / respawn
# ---------------------------

func take_hit(direction: Vector2, hp_damage: float) -> void:
	hp -= hp_damage
	hp = max(hp, 0)

	damage_percent += HIT_DAMAGE_PERCENT
	var scaled_knockback = BASE_KNOCKBACK * (1.0 + damage_percent / 100.0)

	velocity = direction.normalized() * scaled_knockback
	knockback_timer = KNOCKBACK_DURATION

	_update_label()

	if hp <= 0:
		die()

func take_outer_damage(amount: float) -> void:
	hp -= amount
	hp = max(hp, 0)
	_update_label()
	if hp <= 0:
		die()

func die() -> void:
	if is_dead:
		return

	is_dead = true
	visible = false
	velocity = Vector2.ZERO
	set_physics_process(false)

	stocks -= 1
	if stocks <= 0:
		return

	await get_tree().create_timer(3.0).timeout
	respawn()

func respawn() -> void:
	global_position = respawn_position
	hp = 100.0
	damage_percent = 0.0
	_update_label()
	visible = true
	is_dead = false
	set_physics_process(true)

func _update_label() -> void:
	if damage_label:
		damage_label.text = (
			\"HP: \" + str(int(hp)) +
			\"   |   %: \" + str(int(damage_percent)) +
			\"   |   Stocks: \" + str(stocks)
		)

func _start_dash() -> void:
	dash_active = DASH_DURATION
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ij6vw"]
size = Vector2(13, 16)

[sub_resource type="Animation" id="Animation_ghijl"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_ebjds"]
resource_name = "attack_down"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [96, 97, 98, 99]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_wyqjk"]
resource_name = "attack_left"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [112, 113, 114, 115]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_k85er"]
resource_name = "attack_right"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [112, 113, 114, 115]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_qnedo"]
resource_name = "attack_up"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [104, 105, 106, 107]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_ij6vw"]
resource_name = "idle_down"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_6ct3r"]
resource_name = "idle_left"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [16, 17, 18, 19]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_1kp85"]
resource_name = "idle_right"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [16, 17, 18, 19]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_qp52p"]
resource_name = "idle_up"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [8, 9, 10, 11]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.06666667),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_4sjlk"]
resource_name = "walk_down"
length = 1.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [48, 49, 50, 51, 52, 53]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.016666668),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_44cfe"]
resource_name = "walk_left"
length = 1.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [64, 65, 66, 67, 68, 69]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.016666668),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_dd465"]
resource_name = "walk_right"
length = 1.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [64, 65, 66, 67, 68, 69]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.033333335),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_lhvu3"]
resource_name = "walk_up"
length = 1.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4000169, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [56, 57, 58, 59, 60, 61]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:flip_h")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.016666668),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_dd465"]
_data = {
&"RESET": SubResource("Animation_ghijl"),
&"attack_down": SubResource("Animation_ebjds"),
&"attack_left": SubResource("Animation_wyqjk"),
&"attack_right": SubResource("Animation_k85er"),
&"attack_up": SubResource("Animation_qnedo"),
&"idle_down": SubResource("Animation_ij6vw"),
&"idle_left": SubResource("Animation_6ct3r"),
&"idle_right": SubResource("Animation_1kp85"),
&"idle_up": SubResource("Animation_qp52p"),
&"walk_down": SubResource("Animation_4sjlk"),
&"walk_left": SubResource("Animation_44cfe"),
&"walk_right": SubResource("Animation_dd465"),
&"walk_up": SubResource("Animation_lhvu3")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qp52p"]
animation = &"attack_down"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6ct3r"]
animation = &"attack_up"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_1kp85"]
animation = &"attack_right"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qnedo"]
animation = &"attack_left"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_6ct3r"]
blend_point_0/node = SubResource("AnimationNodeAnimation_qp52p")
blend_point_0/pos = Vector2(0, 1)
blend_point_1/node = SubResource("AnimationNodeAnimation_6ct3r")
blend_point_1/pos = Vector2(0, -1)
blend_point_2/node = SubResource("AnimationNodeAnimation_1kp85")
blend_point_2/pos = Vector2(1, 0)
blend_point_3/node = SubResource("AnimationNodeAnimation_qnedo")
blend_point_3/pos = Vector2(-1, 0)
blend_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_44cfe"]
animation = &"idle_down"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_dd465"]
animation = &"idle_up"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_lhvu3"]
animation = &"idle_right"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_4sjlk"]
animation = &"idle_left"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_wyqjk"]
blend_point_0/node = SubResource("AnimationNodeAnimation_44cfe")
blend_point_0/pos = Vector2(0, 1)
blend_point_1/node = SubResource("AnimationNodeAnimation_dd465")
blend_point_1/pos = Vector2(0, -1)
blend_point_2/node = SubResource("AnimationNodeAnimation_lhvu3")
blend_point_2/pos = Vector2(1, 0)
blend_point_3/node = SubResource("AnimationNodeAnimation_4sjlk")
blend_point_3/pos = Vector2(-1, 0)
blend_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_y1dt5"]
animation = &"walk_left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_au0nh"]
animation = &"walk_right"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ij6vw"]
animation = &"walk_down"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ghijl"]
animation = &"walk_up"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_76bt2"]
blend_point_0/node = SubResource("AnimationNodeAnimation_y1dt5")
blend_point_0/pos = Vector2(-1, 0)
blend_point_1/node = SubResource("AnimationNodeAnimation_au0nh")
blend_point_1/pos = Vector2(1, 0)
blend_point_2/node = SubResource("AnimationNodeAnimation_ij6vw")
blend_point_2/pos = Vector2(0, 1)
blend_point_3/node = SubResource("AnimationNodeAnimation_ghijl")
blend_point_3/pos = Vector2(0, -1)
blend_mode = 1

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_sxias"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ucfvk"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2dyae"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_1kp85"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_qnedo"]

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_2u5n8"]
states/Start/position = Vector2(101, 100)
states/attack/node = SubResource("AnimationNodeBlendSpace2D_6ct3r")
states/attack/position = Vector2(264, 204)
states/idle/node = SubResource("AnimationNodeBlendSpace2D_wyqjk")
states/idle/position = Vector2(264, 100)
states/walk/node = SubResource("AnimationNodeBlendSpace2D_76bt2")
states/walk/position = Vector2(510, 100)
transitions = ["Start", "idle", SubResource("AnimationNodeStateMachineTransition_sxias"), "idle", "walk", SubResource("AnimationNodeStateMachineTransition_ucfvk"), "walk", "idle", SubResource("AnimationNodeStateMachineTransition_2dyae"), "idle", "attack", SubResource("AnimationNodeStateMachineTransition_1kp85"), "attack", "idle", SubResource("AnimationNodeStateMachineTransition_qnedo")]
graph_offset = Vector2(-28, 65)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wyqjk"]
size = Vector2(11, 8)

[node name="CharacterBody2D" type="CharacterBody2D"]
collision_layer = 2
collision_mask = 7
motion_mode = 1
script = SubResource("GDScript_4j004")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_f50pn")
hframes = 8
vframes = 15

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-0.5, -2)
shape = SubResource("RectangleShape2D_ij6vw")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_dd465")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_2u5n8")
anim_player = NodePath("../AnimationPlayer")
parameters/attack/blend_position = Vector2(0.48284113, -0.015015006)
parameters/idle/blend_position = Vector2(-0.010309279, 0.1748879)
parameters/walk/blend_position = Vector2(0, -0.02242148)

[node name="AttackHitBox" type="Area2D" parent="."]
collision_layer = 8
collision_mask = 4

[node name="CollisionShape2D" type="CollisionShape2D" parent="AttackHitBox"]
shape = SubResource("RectangleShape2D_wyqjk")
debug_color = Color(0.5045533, 0.54286903, 0.85489804, 0.12941177)
